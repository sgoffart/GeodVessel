Metadata-Version: 2.4
Name: geodesic-vessels
Version: 0.1.0
Summary: geodesic-vessels is a Python package for geodesic-based vessel reconnection and reconstruction. It aims to restore vascular continuity by reconnecting fragmented vessel segments using geodesic paths, while maintaining realistic topology and geometry. The package is designed for use in medical image analysis, particularly angiographic, CT, and MRI vascular datasets.
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: networkx>=3.5
Requires-Dist: nibabel>=5.3.2
Requires-Dist: numpy>=2.3.4
Requires-Dist: pillow>=12.0.0
Requires-Dist: scikit-image>=0.25.2
Requires-Dist: scikit-learn>=1.7.2
Requires-Dist: simpleitk>=2.5.2
Requires-Dist: torch>=2.9.0
Requires-Dist: tqdm>=4.67.3

# Geodesic Vessels

This repository contains tools for analyzing and reconstructing vascular
structures using geodesic distances computed on medical images.  The code
is primarily written in Python and relies on NumPy, PyTorch, SciPy,
scikit-learn and visualization libraries (Plotly, PyVista).

## Package Structure

- **src/geodesic_vessels/**
  - `utils.py` – miscellaneous helpers including image comparison,
    3D rendering functions and Gaussian mixture models for lumen
    probability estimation.
  - `extremities.py` – routines for extracting component extremities
    (endpoints) from a labeled mask; supports skeletonization, graph
    conversion, tangent and radius estimation.
  - `paths.py` – core geodesic distance computation using a GPU- accelerated
    Jacobi solver; backtracking, path validity and multi-component path
    management classes are included.
  - `reconstructions.py` – methods to rebuild tubular vessels from
    centerline paths using radius or geodesic-based heuristics.
  - `metrics.py` – evaluation metrics helpers.
  - `hyperparameters.py` – configuration helpers.
  - `main.py` – entry points for command-line usage.
  - `__init__.py` – package initializer.

## Key Concepts

1. **Extremity Extraction**
   - Use `Extremities3D` to derive skeletons of labeled components and
     identify endpoint coordinates with associated tangent directions and
     radii.

2. **Geodesic Path Computation**
   - Every extremity is processed by `GeodesicPath3D` to compute a
     3D geodesic cost map via a Jacobi iteration (`geodesic_distance_torch_3d`).
   - Backtracking finds minimal-energy paths through the cost map.
   - `GeodesicPaths3D` orchestrates path computation for all extremities,
     filtering duplicates and exporting merged cost maps.

3. **Reconstruction**
   - The `ReconstructVessel3D` class can rebuild a vessel mask from a
     centerline path using several strategies (`radius`, `geodesic`,
     `scale`, `centerline`).  `ReconstructVessels3D` handles multiple
     paths.

4. **Utilities**
   - Visualization of segmentation results (2D/3D) and rendering of
     surfaces using PyVista.
   - GMM-based probability estimation for lumen segmentation.
   - Calibration of probabilistic maps.

## Installation

Clone the repository and install the package.
   ```bash
   git clone <repo-url> geodesic-vessels
   cd geodesic-vessels
   pip install .
   ```

## Basic Usage Examples

Below are snippets illustrating common workflows.

### Extract extremities and compute paths
```python
from geodesic_vessels.extremities import Extremities3D
from geodesic_vessels.paths import GeodesicPaths3D

labeled_mask = ...  # numpy array with integer labels
img = ...  # grayscale image volume
prob = ...  # optional probability map

ext = Extremities3D(labeled_mask)
ext.build_graphs_for_components(verbose=True)
ext.compute_tangents_for_all_extremities()
ext.compute_radii_for_all_extremities_mask(max_r=8)

paths = GeodesicPaths3D(ext, img, labeled_mask, prob)
paths.compute_all_paths()
unique = paths.filter_duplicates()
cost_volume = paths.export_cost_maps()
```

### Compact benchmark example

The `tests/benchmark_5folds_ASOCA_3d.py` script illustrates a full
pipeline.  You can either run it directly:

```bash
python tests/benchmark_5folds_ASOCA_3d.py
```

or invoke individual pieces in Python:

```python
from tests.benchmark_5folds_ASOCA_3d import process_patient, DEFAULT_PARAMS
import os

os.makedirs("out", exist_ok=True)
res = process_patient("0019", 0, "out")
print(res["metrics_new"])
```

The helper module has been removed from the package; please rely on the
benchmark scripts or your own plotting code.

## Testing & Benchmarks
The `tests/` directory contains various scripts used to benchmark the
algorithms on different datasets.  They can be executed directly with
`python` and typically save output figures to the working directory.

## Contribution & Maintenance
- Add README sections or update existing ones when new functionality is
  introduced.
- Keep docstrings in sync with code; many functions now include
  comprehensive descriptions.

---

This README reflects the current state (Feb 2026) of the package and
should be kept up-to-date when adding features or reorganizing the code.
